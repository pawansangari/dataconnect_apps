# Databricks Apps Configuration for CMS-10114 NPI Application
# This is an enhanced configuration for production deployment

name: cms-npi-app
description: CMS-10114 National Provider Identifier Application Form

# Environment variables (using Databricks Secrets)
env:
  - name: PGDATABASE
    valueFrom:
      secretKeyRef:
        scope: db-scope
        key: database
  - name: PGUSER
    valueFrom:
      secretKeyRef:
        scope: db-scope
        key: user
  - name: PGHOST
    valueFrom:
      secretKeyRef:
        scope: db-scope
        key: host
  - name: PGPORT
    value: "5432"
  - name: PGSSLMODE
    value: "require"
  - name: PGAPPNAME
    value: "npi_app"

# Service definitions
services:
  # Backend API Service
  - name: backend
    command: 
      - uvicorn
      - main:app
      - --host
      - "0.0.0.0"
      - --port
      - "8000"
      - --workers
      - "4"
    working_directory: backend
    port: 8000
    health_check:
      path: /api/health
      interval: 30
      timeout: 10
      retries: 3
    
  # Frontend Service
  - name: frontend
    command:
      - python3
      - -m
      - http.server
      - "3000"
    working_directory: frontend
    port: 3000
    health_check:
      path: /
      interval: 30
      timeout: 10
      retries: 3

# Resource configuration
resources:
  cpu: "2"
  memory: "4Gi"

# Scaling configuration (optional)
scaling:
  min_instances: 1
  max_instances: 5
  target_cpu_utilization: 70

# Networking
networking:
  ingress:
    - path: /api
      service: backend
      port: 8000
    - path: /
      service: frontend
      port: 3000

